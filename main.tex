%================================================================================
%  TEMPLATE DE RAPPORT DE STAGE – ENIB + DEAL
%================================================================================

\documentclass[12pt,a4paper]{report}

% ------------------------------------------
% PACKAGES
% ------------------------------------------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[main=french,provide=*]{babel}
\usepackage{microtype}

\usepackage[none]{hyphenat}
\hyphenation{imports}


\usepackage{graphicx}
\usepackage{lmodern}
\usepackage{geometry}

\geometry{
  left=2cm,
  right=2cm,
  top=2cm,
  bottom=3.5cm
}

\usepackage[raggedright]{titlesec}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{color}
\usepackage{tocloft}

\renewcommand{\cftchapfont}{\raggedright\bfseries\color{ENIBblue}}
\renewcommand{\cftsecfont}{\raggedright}
\renewcommand{\cftsubsecfont}{\raggedright}


% Sommaire compact
\setlength{\cftbeforechapskip}{0.3em}
\setlength{\cftbeforesecskip}{0.1em}
\setlength{\cftbeforesubsecskip}{0pt}


\usepackage{float}

% --- Glossaire ---
\usepackage[acronym]{glossaries}
\makeglossaries
\setacronymstyle{short-long}
\input{chapters/glossaire}



% --- Empêche printglossary de créer un saut de page + un titre automatique ---
\renewcommand*{\glossarysection}[2][]{%
    % Ne rien faire : pas de saut de page, pas de section automatique
}

% ------------------------------------------------------------------
% Style personnalisé du glossaire : ENIBStyle
% ------------------------------------------------------------------
\newglossarystyle{enibstyle}{
  \setglossarystyle{long}

  % Désactive toute numérotation de pages en fin d'entrée
  \renewcommand*{\glspostdescription}{}

  % Style : acronyme en bleu ENIB
  \renewcommand*{\glsnamefont}[1]{\textbf{\color{ENIBblue}##1}}

  % Structure du tableau (2 colonnes)
  \renewenvironment{theglossary}{
    \begin{longtable}{@{}p{0.25\textwidth}p{0.72\textwidth}@{}}
  }{
    \end{longtable}
  }

  % Chaque entrée du glossaire (sans lignes)
  \renewcommand{\glossentry}[2]{%
    \glsentryitem{##1}%
    \glstarget{##1}{\glossentryname{##1}} &
    \glossentrydesc{##1}%
    \tabularnewline
  }
}



\setstretch{1.55}

\hyphenpenalty=500
\exhyphenpenalty=50


% Empêcher l'interligne d'affecter les titres
\usepackage{etoolbox}
\makeatletter
\pretocmd{\chapter}{\singlespacing}{}{}
\pretocmd{\section}{\singlespacing}{}{}
\pretocmd{\subsection}{\singlespacing}{}{}
\makeatother



\setlength{\parskip}{0.6em}
\setlength{\parindent}{0pt}



% Correction du warning fancyhdr
\setlength{\headsep}{22pt}  % valeur par défaut : 25pt
\setlength{\headheight}{42pt}
\setlength{\footskip}{34pt}
\addtolength{\topmargin}{-2pt}

% ------------------------------------------
% COULEURS
% ------------------------------------------
\definecolor{ENIBblue}{RGB}{5,55,105}



% ------------------------------------------
% STYLE TITRES (harmonisé)
% ------------------------------------------

% ===== CHAPITRES NUMÉROTÉS =====
\titleformat{\chapter}
  {\Huge\bfseries\color{ENIBblue}}
  {\thechapter.\ }{0.75em}{}
\titlespacing*{\chapter}{0pt}{1em}{1.2em}

% Amélioration : éviter page blanche inutile avant le premier chapitre
\preto\chapter{%
  \ifnum\value{page}>1\clearpage\fi
}



% ===== CHAPITRES NON NUMÉROTÉS =====
\newcommand{\BlueChapter}[1]{%
  \clearpage
  \phantomsection
  \vspace*{0.6cm} % <-- ESPACE ENTRE L’EN-TÊTE ET LE TITRE
  {\Huge\bfseries\color{ENIBblue}\raggedright #1}\par  
  \addcontentsline{toc}{chapter}{#1}%
  \vspace{1.5em}
}


% ===== SECTIONS =====
\titleformat{\section}
  {\large\bfseries\color{black}}
  {\thesection.\ }{0.75em}{}
\titlespacing*{\section}{0pt}{1.5em}{1.2em}



% ===== SOUS-SECTIONS =====
\titleformat{\subsection}
  {\normalsize\bfseries\color{black}}
  {\thesubsection.\ }{0.75em}{}
\titlespacing*{\subsection}{0pt}{1em}{0.8em}

\setlength{\textfloatsep}{2em}
\setlength{\floatsep}{1.6em}
\setlength{\intextsep}{1.6em}

% ===== CHAPITRE ANNEXES (version compacte) =====
\newcommand{\BlueChapterAnnexes}[1]{%
  \clearpage
  \phantomsection
  {\Huge\bfseries\color{ENIBblue}\raggedright #1}\par
  \addcontentsline{toc}{chapter}{#1}%
  \vspace{0.8em} % <-- volontairement réduit
}

\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning}

    
\usepackage[colorlinks=true,
            linkcolor=black,
            urlcolor=ENIBblue,
            citecolor=ENIBblue]{hyperref}

\usepackage[normalem]{ulem} % pour \uline sans casser \emph

\usepackage{needspace}
\pretocmd{\section}{\needspace{5\baselineskip}}{}{}
\pretocmd{\subsection}{\needspace{4\baselineskip}}{}{}


\let\oldhref\href
\renewcommand{\href}[2]{\oldhref{#1}{\uline{#2}}}




% ------------------------------------------
% TABLE DES MATIÈRES — BLEU
% ------------------------------------------
\renewcommand{\cfttoctitlefont}{\Huge\bfseries\color{ENIBblue}}
\renewcommand{\cftloftitlefont}{\Huge\bfseries\color{ENIBblue}}

\renewcommand{\cftchapfont}{\bfseries\color{ENIBblue}}
\renewcommand{\cftchappagefont}{\bfseries\color{ENIBblue}}



% Style du titre de la table des matières
\renewcommand{\contentsname}{\color{ENIBblue}\LARGE\bfseries Table des matières}

\setlength{\cftbeforetoctitleskip}{0.5em}
\setlength{\cftaftertoctitleskip}{1em}
% Style du titre de la liste des figures
\renewcommand{\listfigurename}{\color{ENIBblue}\Huge\bfseries Liste des figures}

% Style français des annexes
\addto\captionsfrench{%
  \renewcommand{\appendixname}{Annexe}
}

% ------------------------------------------
% INFORMATIONS DU RAPPORT
% ------------------------------------------
\newcommand{\StudentName}{Basile André}
\newcommand{\StudentEmail}{b1andre@enib.fr}
\newcommand{\StageShortTitle}{Développement Géonature}
\newcommand{\StageTitle}{Développement d'un module externe de l'application Géonature pour importer les données de Quadrige}
\newcommand{\DatesStage}{Septembre – Décembre 2025}
\newcommand{\Entreprise}{DEAL Réunion}
\newcommand{\TuteurEntr}{Rémi Bouilly}
\newcommand{\TuteurAcad}{Jean-François Favennec}
\newcommand{\SignatureTuteurEntr}{images/autres/remi_bouilly.png}

% ------------------------------------------
% PAGE DE GARDE (COMPLÈTE)
% ------------------------------------------
\newcommand{\PageDeGarde}{
\begin{titlepage}
\thispagestyle{empty}

\noindent
\begin{minipage}[t][0.48\textheight][t]{\textwidth}
    \includegraphics[width=\textwidth, height=0.48\textheight]{images/logos/Corail-ile-de-la-reunion.jpg}

    \vspace*{-0.48\textheight}
    \begin{minipage}[t]{\textwidth}
        \vspace{0.6cm}

        \begin{minipage}{0.5\textwidth}
            \hspace{0.2cm}
            \includegraphics[height=1.7cm]{images/logos/logo_DEAL.png}
        \end{minipage}
        \begin{minipage}{0.48\textwidth}
            \raggedleft
            {\Large\color{white}\DatesStage\hspace{0.2cm}}
        \end{minipage}

        \vspace{1.6cm}
        \begin{minipage}{0.6\textwidth}
            \raggedright
            \hspace{0.2cm}{\Large\bfseries\color{white}\Entreprise}\\
            \hspace{0.2cm}{\Large\bfseries\color{white}ENIB}
        \end{minipage}

        \vspace{1.8cm}
        \begin{center}
            {\fontsize{28}{32}\selectfont\bfseries\color{white}\StageShortTitle}
        \end{center}

    \end{minipage} 
\end{minipage}   

\vspace{1.8cm}
\begin{minipage}{0.6\textwidth}
    \textbf{Stagiaire :} \StudentName\\[0.25cm]

    \textbf{Tuteur entreprise :} \TuteurEntr\\[0.25cm]

    \textbf{Tuteur académique :} \TuteurAcad\\[-0.1cm]

    \hspace{1.8cm}%
    \includegraphics[height=3cm]{\SignatureTuteurEntr}
\end{minipage}

\vfill

\begin{center}
    \begin{minipage}{0.25\textwidth}
        \centering
        \includegraphics[height=1.1cm]{images/logos/Enib_inp_2025.png}
    \end{minipage}
    \begin{minipage}{0.45\textwidth}
        \centering
        \rule{\textwidth}{0.4pt}
    \end{minipage}
    \begin{minipage}{0.25\textwidth}
        \raggedleft {\small \StudentEmail}
    \end{minipage}

    \vspace{0.25cm}
    {\Large\bfseries \StudentName}
\end{center}

\end{titlepage}
}


% ------------------------------------------
% EN-TÊTE + PIED DE PAGE
% ------------------------------------------
\renewcommand{\headrulewidth}{0.8pt}
\renewcommand{\headrule}{\color{ENIBblue}\rule{\headwidth}{0.8pt}}

\fancypagestyle{standard}{
    \fancyhf{}

    \fancyhead[L]{\includegraphics[height=0.9cm]{images/logos/Enib_inp_2025.png}}
    \fancyhead[R]{%
  \raisebox{-0.2\height}{%
    \includegraphics[height=1.6cm]{images/logos/logo_DEAL.png}%
  }%
}


    \fancyfoot[C]{\color{ENIBblue}\rule{\textwidth}{0.4pt}}
    \fancyfoot[L]{\small\color{ENIBblue} \StudentEmail}
    \fancyfoot[C]{\small\color{ENIBblue} Stage Assistant Ingénieur\\[-0.2em]\textbf{\StageShortTitle}}
    \fancyfoot[R]{\small\color{ENIBblue} \thepage}
}

\makeatletter
\let\ps@plain\ps@standard
\makeatother

% ===== ENVIRONNEMENT TEXTE LIMINAIRE (remerciements, résumés) =====
\newenvironment{frontmattertext}{%
  \setstretch{1.3}%
  \setlength{\parskip}{0.4em}%
}{}


%===============================================================================
% DOCUMENT
%===============================================================================

% Styles et mise en page

\begin{document}

\PageDeGarde

\pagestyle{standard}
\setcounter{page}{1}

% début du contenu 
% ------------------------------------------

\BlueChapter{Remerciements}
\begin{frontmattertext}
\input{chapters/remerciements}
\end{frontmattertext}

\BlueChapter{Résumé (FR)}
\begin{frontmattertext}
\input{chapters/resumes/resume_fr}
\end{frontmattertext}

\BlueChapter{Abstract (EN)}
\begin{frontmattertext}
\input{chapters/resumes/resume_en}
\end{frontmattertext}

% ------------------------------------------
% TABLE DES MATIÈRES 
% ------------------------------------------
\clearpage
\phantomsection

\begingroup
  \small
  \setstretch{1.0}        % interligne normal
  \setlength{\parskip}{0pt} % pas d’espace entre entrées
  \tableofcontents
\endgroup

\clearpage


% GLOSSAIRE
\BlueChapter{Glossaire}

\vspace{1.2em}

\begingroup
\setlength{\LTpre}{0pt}
\setlength{\LTpost}{0pt}
\printglossary[type=\acronymtype, style=enibstyle, title={}]
\endgroup

% ------------------------------------------
% CHAPITRES NUMÉROTÉS
% ------------------------------------------

% ------------------------------------------
% PRESENTATION DE L'ENTREPRISE

\chapter{Présentation de l'entreprise}
\section{DEAL Réunion}
\input{chapters/presentation_entreprise/presentation_deal}
\section{Diagnostic RSE}
\input{chapters/presentation_entreprise/diag_rse/intro_diag_rse}
\subsection{Risques et impacts des activités}
\input{chapters/presentation_entreprise/diag_rse/risques_et_impacts}
\subsection{Stratégie globale en matière de RSE}
\input{chapters/presentation_entreprise/diag_rse/strategie_globale_rse}
\subsection{Conclusion personnelle}
\input{chapters/presentation_entreprise/diag_rse/conclusion_personnelle}
% ------------------------------------------
% Organisation du stage
%-------------------------------------------
\chapter{Organisation du stage}
\section{Contexte du stage}
\input{chapters/organisation_stage/contexte_stage}
\section{Objectifs du stage}
\input{chapters/organisation_stage/objectifs_stage}
\section{Méthodologie de travail}
\input{chapters/organisation_stage/methodologie_travail}

% ------------------------------------------
% Introduction au fonctionnement de Géonature
% ------------------------------------------
\chapter{Introduction à GeoNature}
\input{chapters/introduction_geonature/introduction_geonature}

% ------------------------------------------
% Developpement du module d'import Quadrige
% ------------------------------------------
\chapter{Developpement des modules d'\allowbreak imports de données}
\input{chapters/developpement_modules_imports/developpement_modules_imports.tex}


% ------------------------------------------
% Travaux réalisés et compétences acquises
% ------------------------------------------
\chapter{Travaux réalisés et compétences \allowbreak acquises}

\section{Synthèse des travaux réalisés}
\input{chapters/travaux_et_competences_acquises/travaux_realises}

\section{Positionnement et choix d’ingénierie}
\input{chapters/travaux_et_competences_acquises/positionnement_choix_inge}

\section{Arbitrages techniques}
\input{chapters/travaux_et_competences_acquises/arbitrages_techniques}

\section{Difficultés rencontrées et solutions apportées}
\input{chapters/travaux_et_competences_acquises/difficultes_rencontres_solutions_apportees}

\section{Compétences acquises et prise de recul}
\input{chapters/travaux_et_competences_acquises/competances_acquises_prises_recul}

% ------------------------------------------  

% ------------------------------------------
% PERSPECTIVES ET CONCLUSION
% ------------------------------------------
\chapter{Perspectives}
\input{chapters/perspectives/perspectives}


% ------------------------------------------
% CONCLUSION
% ------------------------------------------
\chapter{Conclusion}
\input{chapters/conclusion/conclusion}


% ------------------------------------------
% ANNEXES
% ------------------------------------------
\BlueChapterAnnexes{Annexes}
\enlargethispage{1.5\baselineskip}
\input{chapters/annexes}


% ------------------------------------------
% WEBOGRAPHIE
% ------------------------------------------
\BlueChapter{Webographie}
\input{chapters/webographie}



\end{document}


